## PostgreSQL 17 preview - plpgsql 支持定义 `%TYPE` `%ROWTYPE` 数组变量类型   
                                
### 作者                                
digoal                                
                                
### 日期                                
2024-01-05                         
                                
### 标签                                
PostgreSQL , PolarDB , DuckDB , plpgsql , 字段类型数组 , 行类型数组    
                                
----                                
                                
## 背景     
https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=5e8674dc83926f52516f847f1a77e8d38e94e143  
  
PostgreSQL 17 preview - plpgsql 支持定义 `%TYPE` `%ROWTYPE` 数组变量类型 , 一看commit info, 是亮哥没错.    
  
```  
In plpgsql, allow %TYPE and %ROWTYPE to be followed by array decoration.  
author	Tom Lane <tgl@sss.pgh.pa.us>	  
Thu, 4 Jan 2024 20:24:15 +0000 (15:24 -0500)  
committer	Tom Lane <tgl@sss.pgh.pa.us>	  
Thu, 4 Jan 2024 20:24:15 +0000 (15:24 -0500)  
commit	5e8674dc83926f52516f847f1a77e8d38e94e143  
tree	4e6cdedbef9caf962a56522b0b257550c90ab18c	tree  
parent	5d06e99a3cfc23bbc217b4d78b8c070ad52f720e	commit | diff  
  
In plpgsql, allow %TYPE and %ROWTYPE to be followed by array decoration.  
  
This provides the useful ability to declare a variable that is an array  
of the type of some other variable or some table column.  
  
Quan Zongliang, Pavel Stehule  
  
Discussion: https://postgr.es/m/ec4523e1-9e7e-f3ef-f9ce-bafd680ad6f6@yeah.net  
```  
  
```  
+   <para>  
+    It is also possible to write array decoration  
+    after <literal>%TYPE</literal>, thereby creating a variable that holds  
+    an array of the referenced type:  
+<programlisting>  
+user_ids users.user_id%TYPE[];  
+user_ids users.user_id%TYPE ARRAY[4];  -- equivalent to the above  
+</programlisting>  
+    Just as when declaring table columns that are arrays, it doesn't  
+    matter whether you write multiple bracket pairs or specific array  
+    dimensions: <productname>PostgreSQL</productname> treats all arrays of  
+    a given element type as the same type, regardless of dimensionality.  
+    (See <xref linkend="arrays-declaration"/>.)  
+   </para>  
  
+   <para>  
+    As with <literal>%TYPE</literal>, <literal>%ROWTYPE</literal> can be  
+    followed by array decoration to declare a variable that holds an array  
+    of the referenced composite type.  
+   </para>  
```  
  
例子  
```  
user_ids users.user_id%TYPE[];  
user_ids users.user_id%TYPE ARRAY[4];  -- equivalent to the above  
  
vuser users%ROWTYPE[]  
vuser users%ROWTYPE ARRAY[4];  -- equivalent to the above  
```
  
