## PostgreSQL 17 preview - 主库视图 `pg_replication_slots`.`conflict_reason` 支持逻辑复制冲突原因跟踪       
                              
### 作者                              
digoal                              
                              
### 日期                              
2024-01-04                       
                              
### 标签                              
PostgreSQL , PolarDB , DuckDB , 逻辑复制冲突 , pg_replication_slots  
                              
----                              
                              
## 背景   
从库通过pg_stat_database_conflicts可以观测物理复制冲突, 对于逻辑复制冲突如何观测?   
  
PostgreSQL 17 通过视图 `pg_replication_slots`.`conflict_reason` 支持逻辑复制冲突原因跟踪:   
- wal_removed = required WAL has been removed.  
- rows_removed = required rows have been removed.  
- wal_level_insufficient = the primary doesn't have a wal_level sufficient to perform logical decoding.  
  
  
https://www.postgresql.org/docs/devel/view-pg-replication-slots.html  
  
https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=007693f2a3ac2ac19affcb03ad43cdb36ccff5b5  
  
```  
Track conflict_reason in pg_replication_slots.   
  
author	Amit Kapila <akapila@postgresql.org>	  
Thu, 4 Jan 2024 02:51:51 +0000 (08:21 +0530)  
committer	Amit Kapila <akapila@postgresql.org>	  
Thu, 4 Jan 2024 02:56:25 +0000 (08:26 +0530)  
commit	007693f2a3ac2ac19affcb03ad43cdb36ccff5b5  
tree	548cee95ca1d16e7b7f87baa951e779bf8f0dfd1	tree  
parent	29275b1d177096597675b5c6e7e7c9db2df8f4df	commit | diff  
Track conflict_reason in pg_replication_slots.  
  
This patch changes the existing 'conflicting' field to 'conflict_reason'  
in pg_replication_slots. This new field indicates the reason for the  
logical slot's conflict with recovery. It is always NULL for physical  
slots, as well as for logical slots which are not invalidated. The  
non-NULL values indicate that the slot is marked as invalidated. Possible  
values are:  
  
wal_removed = required WAL has been removed.  
rows_removed = required rows have been removed.  
wal_level_insufficient = the primary doesn't have a wal_level sufficient  
to perform logical decoding.  
  
The existing users of 'conflicting' column can get the same answer by  
using 'conflict_reason' IS NOT NULL.  
  
Author: Shveta Malik  
Reviewed-by: Amit Kapila, Bertrand Drouvot, Michael Paquier  
Discussion: https://postgr.es/m/ZYOE8IguqTbp-seF@paquier.xyz  
```  
  
