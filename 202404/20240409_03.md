## PostgreSQL 17 preview - 新增 GUC trace_connection_negotiation : 跟踪客户端 SSLRequest or GSSENCRequest packet   
                                                                                                     
### 作者                                                                                                        
digoal                                                                                                      
                                                                                                  
### 日期                                                                                                   
2024-04-09                                                                                          
                                                                                                              
### 标签                                                                              
PostgreSQL , PolarDB , DuckDB , trace_connection_negotiation   
                                                                                                              
----                                                                                                              
                                                                                                              
## 背景    
  
https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=705843d294d5d3bc5cce4001596df4df5f1c8b59  
```  
Enhance libpq encryption negotiation tests with new GUC  
  
author	Heikki Linnakangas <heikki.linnakangas@iki.fi>	  
Sun, 7 Apr 2024 23:49:37 +0000 (02:49 +0300)  
committer	Heikki Linnakangas <heikki.linnakangas@iki.fi>	  
Sun, 7 Apr 2024 23:49:37 +0000 (02:49 +0300)  
commit	705843d294d5d3bc5cce4001596df4df5f1c8b59  
tree	383337ffbcc0346ee4a084c611d65e8930ceeb8f	tree  
parent	20f9b61cc1926775b1ceb25196df942efaf8bdd2	commit | diff  
Enhance libpq encryption negotiation tests with new GUC  
  
The new "log_connection_negotiation" server option causes the server  
to print messages to the log when it receives a SSLRequest or  
GSSENCRequest packet from the client. Together with "log_connections",  
it gives a trace of how a connection and encryption is  
negotiatated. Use the option in the libpq_encryption test, to verify  
in more detail how libpq negotiates encryption with different  
gssencmode and sslmode options.  
  
This revealed a couple of cases where libpq retries encryption or  
authentication, when it should already know that it cannot succeed.  I  
marked them with XXX comments in the test tables. They only happen  
when the connection was going to fail anyway, and only with rare  
combinations of options, so they're not serious.  
  
Discussion: https://www.postgresql.org/message-id/CAEze2Wja8VUoZygCepwUeiCrWa4jP316k0mvJrOW4PFmWP0Tcw@mail.gmail.com  
```  
  
```  
+   {  
+       {"trace_connection_negotiation", PGC_POSTMASTER, DEVELOPER_OPTIONS,  
+           gettext_noop("Logs details of pre-authentication connection handshake."),  
+           NULL,  
+           GUC_NOT_IN_SAMPLE  
+       },  
+       &Trace_connection_negotiation,  
+       false,  
+       NULL, NULL, NULL  
+   },  
```  
  
