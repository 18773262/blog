## PostgreSQL 18 preview - 提升 GetLockStatusData 效率, 优化高并发小事务性能   
                                                                                
### 作者                                                    
digoal                                                    
                                                           
### 日期                                                         
2024-10-26                                                    
                                                        
### 标签                                                      
PostgreSQL , PolarDB , DuckDB , 高并发 , 小事务 , fast-path lock , GetLockStatusData                      
                                                                               
----                                                        
                                                                      
## 背景        
重写 GetLockStatusData 跳过pid=0和未注册fast-path lock的groups, 提升效率, 优化高并发小事务性能 .  
  
https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=86c30cef4a4cae951b2c30f1790fd5a7b81a2946  
```  
Refactor GetLockStatusData() to skip backends/groups without fast-path locks.  
author	Fujii Masao <fujii@postgresql.org>	  
Thu, 24 Oct 2024 15:18:32 +0000 (00:18 +0900)  
committer	Fujii Masao <fujii@postgresql.org>	  
Thu, 24 Oct 2024 15:18:32 +0000 (00:18 +0900)  
commit	86c30cef4a4cae951b2c30f1790fd5a7b81a2946  
tree	cc765705c2dea41ff8e7b9896bce3c2126e5101f	tree  
parent	45188c2ea2391b7b24039e1632c726e2fc6b8008	commit | diff  
Refactor GetLockStatusData() to skip backends/groups without fast-path locks.  
  
Previously, GetLockStatusData() checked all slots for every backend  
to gather fast-path lock data, which could be inefficient. This commit  
refactors it by skipping backends with PID=0 (since they don't hold  
fast-path locks) and skipping groups with no registered fast-path locks,  
improving efficiency.  
  
This refactoring is particularly beneficial, for example when  
max_connections and max_locks_per_transaction are set high,  
as it reduces unnecessary checks across numerous slots.  
  
Author: Fujii Masao  
Reviewed-by: Bertrand Drouvot  
Discussion: https://postgr.es/m/a0a00c44-31e9-4c67-9846-fb9636213ac9@oss.nttdata.com  
```  
  
