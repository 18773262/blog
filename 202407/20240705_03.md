## PostgreSQL 18 preview - Support "Right Semi Join" plan shapes    
                                        
### 作者            
digoal            
                   
### 日期                 
2024-07-05              
                
### 标签              
PostgreSQL , PolarDB , DuckDB , Right Semi Join      
                                       
----                
                              
## 背景       
PostgreSQL 18支持right semi join plan shapes     
    
https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=aa86129e19d704afb93cb84ab9638f33d266ee9d  
```  
Support "Right Semi Join" plan shapes  
author	Richard Guo <rguo@postgresql.org>	  
Fri, 5 Jul 2024 00:26:48 +0000 (09:26 +0900)  
committer	Richard Guo <rguo@postgresql.org>	  
Fri, 5 Jul 2024 00:26:48 +0000 (09:26 +0900)  
commit	aa86129e19d704afb93cb84ab9638f33d266ee9d  
tree	0c1643a4ca9aaa321c08f4d896499aed3c961c2c	tree  
parent	5a519abeddfe34659a8c0478f04a0acfd0d80ec6	commit | diff  
  
Support "Right Semi Join" plan shapes  
  
Hash joins can support semijoin with the LHS input on the right, using  
the existing logic for inner join, combined with the assurance that only  
the first match for each inner tuple is considered, which can be  
achieved by leveraging the HEAP_TUPLE_HAS_MATCH flag.  This can be very  
useful in some cases since we may now have the option to hash the  
smaller table instead of the larger.  
  
Merge join could likely support "Right Semi Join" too.  However, the  
benefit of swapping inputs tends to be small here, so we do not address  
that in this patch.  
  
Note that this patch also modifies a test query in join.sql to ensure it  
continues testing as intended.  With this patch the original query would  
result in a right-semi-join rather than semi-join, compromising its  
original purpose of testing the fix for neqjoinsel's behavior for  
semi-joins.  
  
Author: Richard Guo  
Reviewed-by: wenhui qiu, Alena Rybakina, Japin Li  
Discussion: https://postgr.es/m/CAMbWs4_X1mN=ic+SxcyymUqFx9bB8pqSLTGJ-F=MHy4PW3eRXw@mail.gmail.com  
```  
  
```    
1904 --  
1905 -- semijoin selectivity for <>  
1906 --  
1907 explain (costs off)  
1908 select * from tenk1 a, tenk1 b  
1909 where exists(select * from tenk1 c  
1910              where b.twothousand = c.twothousand and b.fivethous <> c.fivethous)  
1911       and a.tenthous = b.tenthous and a.tenthous < 5000;  
1912                   QUERY PLAN                     
1913 -----------------------------------------------  
1914  Hash Semi Join  
1915    Hash Cond: (b.twothousand = c.twothousand)  
1916    Join Filter: (b.fivethous <> c.fivethous)  
1917    ->  Hash Join  
1918          Hash Cond: (b.tenthous = a.tenthous)  
1919          ->  Seq Scan on tenk1 b  
1920          ->  Hash  
1921                ->  Seq Scan on tenk1 a  
1922                      Filter: (tenthous < 5000)  
1923    ->  Hash  
1924          ->  Seq Scan on tenk1 c  
1925 (11 rows)  
```  
  
